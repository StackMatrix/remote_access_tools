<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Writes an `.npy` file (sparse if possible) with bitwise-zero-filled data."><meta name="keywords" content="rust, rustlang, rust-lang, write_zeroed_npy"><title>write_zeroed_npy in ndarray_npy - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-1f7d512b176f0f72.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-124a1ca42af929b6.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-ed67f58bef457aa5.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-a19f8302ea709214.css"><link rel="stylesheet" disabled href="../static.files/dark-f1e56666dd272622.css"><link rel="stylesheet" disabled href="../static.files/ayu-7291d283d92e041c.css"><script id="default-settings" ></script><script src="../static.files/storage-d43fa987303ecbbb.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-4a084badb5778746.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../ndarray_npy/index.html"><div class="logo-container"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../ndarray_npy/index.html"><div class="logo-container"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></div></a><div class="sidebar-elems"><h2><a href="index.html">In ndarray_npy</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-5ec35bf9ca753509.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Function <a href="index.html">ndarray_npy</a>::<wbr><a class="fn" href="#">write_zeroed_npy</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/ndarray_npy/npy/mod.rs.html#158-187">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><div class="item-decl"><pre class="rust fn"><code>pub fn write_zeroed_npy&lt;A, D&gt;(file: &amp;<a class="struct" href="https://doc.rust-lang.org/nightly/std/fs/struct.File.html" title="struct std::fs::File">File</a>, shape: D) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="enum" href="enum.WriteNpyError.html" title="enum ndarray_npy::WriteNpyError">WriteNpyError</a>&gt;<span class="where fmt-newline">where<br>&nbsp;&nbsp;&nbsp;&nbsp;A: <a class="trait" href="trait.WritableElement.html" title="trait ndarray_npy::WritableElement">WritableElement</a>,<br>&nbsp;&nbsp;&nbsp;&nbsp;D: <a class="trait" href="../ndarray/dimension/conversion/trait.IntoDimension.html" title="trait ndarray::dimension::conversion::IntoDimension">IntoDimension</a>,</span></code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Writes an <code>.npy</code> file (sparse if possible) with bitwise-zero-filled data.</p>
<p>The <code>.npy</code> file represents an array with element type <code>A</code> and shape
specified by <code>shape</code>, with all elements of the array represented by an
all-zero byte-pattern. The file is written starting at the current cursor
location and truncated such that there are no additional bytes after the
<code>.npy</code> data.</p>
<p>This function is primarily useful for creating an <code>.npy</code> file for an array
larger than available memory. The file can then be memory-mapped and
modified using <a href="trait.ViewMutNpyExt.html" title="ViewMutNpyExt"><code>ViewMutNpyExt</code></a>.</p>
<h2 id="panics"><a href="#panics">Panics</a></h2>
<p>May panic if any of the following overflow <code>isize</code> or <code>u64</code>:</p>
<ul>
<li>the number of elements in the array</li>
<li>the size of the array in bytes</li>
<li>the size of the resulting file in bytes</li>
</ul>
<h2 id="considerations"><a href="#considerations">Considerations</a></h2><h3 id="data-is-zeroed-bytes"><a href="#data-is-zeroed-bytes">Data is zeroed bytes</a></h3>
<p>The data consists of all zeroed bytes, so this function is useful only for
element types for which an all-zero byte-pattern is a valid representation.</p>
<h3 id="sparse-file"><a href="#sparse-file">Sparse file</a></h3>
<p>On filesystems which support <a href="https://en.wikipedia.org/wiki/Sparse_file">sparse files</a>, most of the data should be
handled by empty blocks, i.e. not allocated on disk. If you plan to
memory-map the file to modify it and know that most blocks of the file will
ultimately contain some nonzero data, then it may be beneficial to allocate
space for the file on disk before modifying it in order to avoid
fragmentation. For example, on POSIX-like systems, you can do this by
calling <code>fallocate</code> on the file.</p>
<h3 id="alternatives"><a href="#alternatives">Alternatives</a></h3>
<p>If all you want to do is create an array larger than the available memory
and don’t care about actually writing the data to disk, it may be worth
considering alternative options:</p>
<ul>
<li>
<p>Add more swap space to your system, using swap file(s) if necessary, so
that you can allocate the array as normal.</p>
</li>
<li>
<p>If you know the data will be sparse:</p>
<ul>
<li>
<p>Use a sparse data structure instead of <code>ndarray</code>’s array types. For
example, the <a href="https://crates.io/crates/sprs"><code>sprs</code></a> crate provides
sparse matrices.</p>
</li>
<li>
<p>Rely on memory overcommitment. In other words, configure the operating
system to allocate more memory than actually exists. However, this
risks the system running out of memory if the data is not as sparse as
you expect.</p>
</li>
</ul>
</li>
</ul>
<h2 id="example"><a href="#example">Example</a></h2>
<p>In this example, a file containing 64 GiB of zeroed <code>f64</code> elements is
created. Then, an <code>ArrayViewMut</code> is created by memory-mapping the file.
Modifications to the data in the <code>ArrayViewMut</code> will be applied to the
backing file. This works even on systems with less than 64 GiB of physical
memory. On filesystems which support <a href="https://en.wikipedia.org/wiki/Sparse_file">sparse files</a>, the disk space that’s
actually used depends on how much data is modified.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>memmap2::MmapMut;
<span class="kw">use </span>ndarray::ArrayViewMut3;
<span class="kw">use </span>ndarray_npy::{write_zeroed_npy, ViewMutNpyExt};
<span class="kw">use </span>std::fs::{File, OpenOptions};

<span class="kw">let </span>path = <span class="string">&quot;array.npy&quot;</span>;

<span class="comment">// Create a (sparse if supported) file containing 64 GiB of zeroed data.
</span><span class="kw">let </span>file = File::create(path)<span class="question-mark">?</span>;
write_zeroed_npy::&lt;f64, <span class="kw">_</span>&gt;(<span class="kw-2">&amp;</span>file, (<span class="number">1024</span>, <span class="number">2048</span>, <span class="number">4096</span>))<span class="question-mark">?</span>;

<span class="comment">// Memory-map the file and create the mutable view.
</span><span class="kw">let </span>file = OpenOptions::new().read(<span class="bool-val">true</span>).write(<span class="bool-val">true</span>).open(path)<span class="question-mark">?</span>;
<span class="kw">let </span><span class="kw-2">mut </span>mmap = <span class="kw">unsafe </span>{ MmapMut::map_mut(<span class="kw-2">&amp;</span>file)<span class="question-mark">? </span>};
<span class="kw">let </span><span class="kw-2">mut </span>view_mut = ArrayViewMut3::&lt;f64&gt;::view_mut_npy(<span class="kw-2">&amp;mut </span>mmap)<span class="question-mark">?</span>;

<span class="comment">// Modify an element in the view.
</span>view_mut[[<span class="number">500</span>, <span class="number">1000</span>, <span class="number">2000</span>]] = <span class="number">3.14</span>;</code></pre></div>
</div></details></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="ndarray_npy" data-themes="" data-resource-suffix="" data-rustdoc-version="1.68.0-nightly (af3e06f1b 2022-12-23)" data-search-js="search-444266647c4dba98.js" data-settings-js="settings-bebeae96e00e4617.js" data-settings-css="settings-58836c674e2f7bd2.css" ></div></body></html>